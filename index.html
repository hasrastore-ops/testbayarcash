<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Bayarcash Test Payment</title>
  </head>
  <body>
    <h2>Bayarcash Sandbox Payment</h2>
    <form id="paymentForm">
      <input name="payer_name" placeholder="Nama" required /><br />
      <input name="payer_email" placeholder="Email" type="email" required /><br />
      <input name="amount" placeholder="Amaun" type="number" step="0.01" required /><br />
      <label><input type="radio" name="payment_channel" value="1" checked /> QR</label>
      <label><input type="radio" name="payment_channel" value="2" /> FPX</label><br /><br />
      <button type="submit">Bayar Sekarang</button>
    </form>

    <script>
      document.getElementById("paymentForm").addEventListener("submit", async (e) => {
        e.preventDefault();
        const formData = Object.fromEntries(new FormData(e.target).entries());

        try {
          const res = await fetch("/api/bayarcash", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(formData),
          });

          const data = await res.json();
          console.log(data);

          if (data.payment_url) {
            window.location.href = data.payment_url;
          } else {
            alert(data.message || "Error creating payment.");
          }
        } catch (err) {
          console.error(err);
          alert("Something went wrong.");
        }
      });
    </script>
  </body>
</html>
